# Windows Service Summary

## 1. Create Windows Service
  [How to create windows service](https://www.c-sharpcorner.com/article/create-windows-services-in-c-sharp/)
  
## 2. Debug Windows Service
1. **UserInteractive**
	Use the following code, you can run your service via F5
	 ```
	if (!Environment.UserInteractive)
	{
		ServiceBase[] ServicesToRun;
		ServicesToRun = new ServiceBase[]
		{
			new WindowsService()
		};
		ServiceBase.Run(ServicesToRun);
	}
	else
	{
		var service = new WindowsService();
		// We need add the internal method 'Start'
		// This method will call the OnStart method.
		service.Start();
		//Sleep until end debug
		Thread.Sleep(Timeout.Infinite);
	}
	```
 2.  **Attatch to the Service Process**
		- Build the windows service with debug model
		- Install the window service
		- Attach to the process
		
		More detail steps, click [HERE](https://docs.microsoft.com/en-us/visualstudio/debugger/attach-to-running-processes-with-the-visual-studio-debugger?view=vs-2019)
 
## 3. Add the installer for Windows Service
1. How add the install in WS.
	- Open the service design page via double click service.cs file
	- Right click in design
	- Click the "Add Installer" item
	- ProjectInstaller will be added
2. Add the install event
	  - In projectInstaller, configurated the service info.
	  - Add the install event as following:
		```        
		public ProjectInstaller() : base()
		{
			InitializeComponent();
			Committed += new InstallEventHandler(CommittedEventHandler);
			AfterUninstall += new InstallEventHandler(AfterUninstallEventHandler);
			AfterInstall += new InstallEventHandler(AfterInstallEventHandler);
		}
		```        
3. Protected the config section data
We can use the following method to encrypt the sensitive info in config file.
More detail info, please see [HERE](https://www.codeproject.com/Articles/15392/Implementing-Protected-Configuration-With-Windows).
	```
        private void ProtectSection()
        {
            string sectionName = "applicationSettings/applicationSettings.Settings";//"connectionStrings";        
            string assemblyFilePath = this.GetType().Assembly.Location;

            var config = ConfigurationManager.OpenExeConfiguration(assemblyFilePath);//.OpenMappedExeConfiguration(fileMap,ConfigurationUserLevel.None);
            ConfigurationSection configSection = config.GetSection(sectionName);
            if (configSection == null)
            {
                return;
            }

            if (!configSection.SectionInformation.IsProtected)
            {
                configSection.SectionInformation.ProtectSection("DataProtectionConfigurationProvider");
            }

            configSection.SectionInformation.ForceSave = true;
            config.Save(ConfigurationSaveMode.Modified);
        }
	```
## 4. Add the SetUp project for Windows Service
  Why no service register after install
  manager the install process via remote server
  Why install event not triggered 
  Set the default install path to ProgramData folder
## 5. How to build the *.MSI file for Windows Service
  Enable build the Setup project in solution
  Why no *.MSI file generated.
## 6. How to install the Windows Service
  InstallUtile.exe to register
  Click the *.MSI file
## 7. Install the Windows Service in remote machine
  permission
  start the msiexe service.

